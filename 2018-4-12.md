## 记录时间范围

2018-3-26入职至2018-4-12

## 工作感想

入职至今，说忙不忙，说闲也不闲，一直有事情可以做，**但无法准确判别事情的轻重紧急程度**，这点尤其致命。

## 工作内容

### 入职后第一周

* 跟潘源交流，了解公司项目情况
* 目前广泛使用的`react-bootstrap-table`组件有不少问题，尝试用现有UI库实现`react-bootstrap-table`组件，统一UI风格之余能更好的实现功能（此条为潘源推荐我的工作安排），目前写了新的`Table`组件的文档，具体实现还在开发中。
* 尝试协助JAVAer解决BUG，由于之前没有进行详细记录，具体事情忘记了，主要问题是JAVAer对js的`Event Loop`不熟悉所致。

### 入职后第二周

* 第一周周五下午长安官网项目会议中提出了点需求，根据需求周一时定了`react 前后端同构`的基础框架，并做了简单测试，基本上能满足需求。
* 周二设计那边下来了第一版设计，由于身体不适周二下午请假回家进行修养。
* 周三随便切了点页面，但由于设计并没有定稿，而且部分设计细节完全不对头，同时不了解产品设计，所以计划暂时先搁置这个项目，目前只有潘源在继续跟进这个项目。

### 入职后第三周

* 周日根据潘源和子文对长安官网项目的几个问题进行了尝试，目前剩余问题可能就是消息队列的问题还不能非常明确，主要是不清楚具体用服务，但理论上这个问题并不是特别大，网上有不少nodejs介入activeMQ的例子可以参考，本人对于直接使用nodejs的socket模块也有一定经验，对网络通信还是有一定了解的。
* 周一上午继续开发新的`Table`组件，下午在尝试解决长安项目部分表格表头处多选按钮*不确定选择*的样式问题，由于使用的是原生input元素，样式操作极其困难，而且只有firefox在linux的版本上的样式风格问题比较大，解决方案目前只有一个，就是重新实现`Checkbox`组件，采用div模拟的方式来实现而不是原生input组件，这样才能解决样式统一的问题，由于实现成本过大（必须手写编译后代码），风险过高，决定暂缓解决。
* 由于周一出现的问题，决定要赶紧想办法解决目前前端开发中发现的各种问题，开始技术尝试具体下文会列出。
* 周三上午，技术尝试告一段落，准备写总结汇报文件，下午决定以工作日志的形式，所以有此文档。

# 本人的工作问题

## 适应问题

出现此问题主要是在本公司工作跟以往工作出现非常大的差异，差异如下：

|差异分类|前公司|本公司|
|------|---------|---------|
|工作内容|具体产品开发|组件开发，帮助JAVAer解决问题|
|任务明确性|强：一切以产品为目标，有详细的工作计划，无论是新产品开发还是旧产品开发均有明确的目的，从而可以做出较为准确的工作时间安排|弱：组件优化目的性弱，没有详细的时间/功能限制，长安官网项目同样没有详细的时间和产品规划|
|开发部署环境|本地开发，公有云部署，git版本控制，灵活性高，使用第三方库方便|私有网络环境开发部署，svn集中化代码管理，无法使用第三方库，版本控制有一定难度，组件分发同样有难度|
|跟后端配合|互联网公司后端大多数已经适应前后端分离开发，会出接口文档，最差也会QQ等通信工具告知|后端长时间兼顾页面开发，没有文档，长安项目目前潘源直接访问原来的旧官网来获取数据调用接口。。。|
|项目复杂度|低：前后端分离后更加专注，再加上互联网项目往往业务简单明了，相对简单|高：后端兼顾前端页面写出来的代码不符合规范，代码耦合度极高，基于`react`的项目部分后端也会方便实现，直接网上找jq代码直接操作dom节点，再加上本身相对庞大的企业信息系统，维护难度高|

## 具体问题及解决方案

### 任务明确性

没有相对明确的任务难以提高效率，同时也没有办法知道目前所工作的内容是否符合公司的需求，为公司产生效益。

沟通是解决这个问题的唯一方法，本人打算借此文档做为开端，多与各位领导沟通。

### 前端项目库的使用和维护

由于公司在内网环境中开发，我猜测是为了方便诸多对前端不是很熟悉的JAVAer使用，封装了一个名为`react-nuts`的标准库，把`semantic-ui`和部分组件还有`react`封装进库中，同时也包含后端代码，做了个标准版项目，然后新项目直接拷贝标准版进行定制开发。

然后各位JAVAer基本上在开发中都是拷贝一个类似的页面，然后根据需求进行修改，而且出现需要前端支援开发主要也出现在这些页面中。部分页面在开发中没有按照常规思路走，例如同步AJAX，直接操作DOM节点等，本身代码质量不佳；修改是往往只修改render方法中跟视图相关的代码，然后添加相应业务的方法，完成功能的实现，这样导致代码中有不少无用的方法，代码过长也难以维护。然后加上可能出现的多次复制，问题一层一层继承下来，变得越来越臃肿越来越难以维护。

部分项目还有移动端的需求，但是这些移动端直接使用PC端的组件，样式难看不说而且体积巨大，而且JAVAer并不懂移动端的前端开发优化，成品效果难以满足客户对UI界面越来越高的要求。

解决方案如下：

#### 搭建私有npm服务器

目前公司项目使用svn进行集中式代码管理，但svn对版本管理并不是特别友好。还有就是目前广泛使用的`react-nuts`库并没有源代码在项目中，导致里面的组件出现bug只能在打包后的`basic.js`中进行修改，修改bug难度提高，而且修改后难以同步到个个项目中。

搭建私有npm服务器可以解决自研组件，第三方库的维护和分发问题：

* 自研组件可以有效的进行版本维护，根据项目的不同需求引用不同的版本，同时版本中有各种问题可以通过发布小版本进行修复；
* 第三方库也可以有效进行调用，在这2天的实验尝试中已经有方法将各个版本的第三方库插入进私有的npm服务中，第三方库出现bug可以根据有无官方解决方案而进行处理，官方以解决的引入新版本解决，未解决的也可以解决后发布私有版本。
* 同时在项目中能够以最佳实践的方式安装组件，而不需要拷贝node_modules文件夹
* 可以安装各种cli工具，根据潘源描述，目前依旧使用webpack1.x主要是webpack安装需要编译，不能直接复制新版本的webpack到项目中。

目前已经在本人开发云上搭建了私有的npm服务，采用的是`Sinopia`方案，这个是基于文件系统的私有npm服务，需要部署第三方库只需要把相关文件拷贝到仓库文件系统中，不需要数据库的操作，方便维护第三方库。内网地址：`http://192.168.22.207:4873`，只要配置一下npm的registry地址就可以直接使用。

已测试功能：
* 安装第三方库，目前已经可以安装webpack4.x，react等最新版第三方库，其他第三方库需要用到可以维护进私有npm服务中
* 发布私有库

#### 安装nvm进行node版本管理

由于目前项目使用的是4.x的node版本，但是不少第三方库已经放弃基于node4.x，最低都要求在node6.x以上的版本，新项目可能会涉及到node8.x的使用，目前我在开发云上是直接更改PATH来控制node版本，但这存在使用上的不方便，nvm可以有效的解决这个问题，但不是必须。

#### 开发新版本的react-nuts

虽然本人觉得这个库是多余的，但是目前已经广泛使用，为了避免对JAVAer在开发上造成不便，这个库还得保留。

目前版本的react-nuts是直接丢在项目的node_modules中，部分组件有bug，而且也不好维护，开发新版本然后存放进私有npm服务中进行维护存在一定必要性。

#### 开发维护新版本的ui库

目前广泛使用的版本老旧的`react-semantic-ui`存在不少bug，而且组件功能单一，样式老旧且不具备多皮肤等项目中有需求的功能，我认为可以弃用`react-semantic-ui`，自行维护一套ui库，主要是样式部分，必须支持多皮肤功能，这样可以根据客户需求切换不同的风格，而且有利于功能上的维护。

目前计划开发一套基础的UI库，主要是对样式的封装，功能会相对简单原始，估计会直接拿现成的第三方的代码进行修改。然后基于这个UI库开发各种组件，类似潘源开发的`PowerfulTable`等组件，方便JAVAer使用。

#### 研发cli工具

如果广泛推广使用了私有npm服务，那么研发一些cli工具则可以提上日程，主要可以实现的功能有：

* 快速搭建项目环境，例如vue-cli等脚手架工具，这样新的项目就无需粘贴复制旧项目。
* 快速新建页面，例如thinkjs-cli的新建控制器，这样在新建页面的时候可以根据需求配置好各种配置文件，而且还可以根据需求生成各种模版文件，这样就不会出现拷贝旧页面同时把旧页面的问题带入新页面中。
* 迭代标准项目环境，cli工具可以通过npm服务进行版本管理，这样新版本的标准项目就可以快速推广。


## 接下来的工作计划

根据上面描述的问题进行了目前的工作计划，具体轻重缓急还请各位领导给予明示

* 维护私有npm服务，讲用到的第三方库维护进去
* 长安官网项目有进展后继续研发
* 开发新版本`react-nuts`
* 开发新版本的UI库
